<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');class Hi_companies extends CI_Controller {		/**	 * The Index Page.	 * The controller which shows options to register new patient.	 */	 	function  __construct() {		parent::__construct();		$this->load->model('clubs/company_model');	}		public function index()	{		$this->show_companies();	}		public function companyinfo()	{		$data['active']='hi_companies';		$data['sub_active']='hi_companies';				$id = $this->input->get('id', TRUE);		$data["hi"] = $this->company_model->compayinfo($id);		$this->load->view('clubs/hiInfo',$data);	}		public function planinfo()	{		$data['active']='hi_companies';		$data['sub_active']='hi_plans';				$id = $this->input->get('id', TRUE);		$data["plans"] = $this->company_model->planinfo($id);		$this->load->view('clubs/planInfo',$data);	}		public function show_companies($page=0)	{				$data['active']='hi_companies';		$data['sub_active']='hi_companies';				if($this->session->userdata(''))			$this->session->unset_userdata('');				$config = array();        $config["base_url"] = base_url() . "clubs/hi_companies/show_companies";        $config["total_rows"] = $this->company_model->companies_count();        $config["per_page"] = 20;		$config['num_links'] = 3;				$config['full_tag_open'] = '<div class="pagination"><ul>';		$config['full_tag_close'] = '</ul></div>';				$config['first_tag_open'] = '<li class="prev page">';		$config['first_tag_close'] = '</li>';		 		$config['last_tag_open'] = '<li class="next page">';		$config['last_tag_close'] = '</li>';				$config['next_tag_open'] = '<li class="next page">';		$config['next_tag_close'] = '</li>';				$config['prev_tag_open'] = '<li class="prev page">';		$config['prev_tag_close'] = '</li>';		 		$config['cur_tag_open'] = '<li class="active"><a href="">';		$config['cur_tag_close'] = '</a></li>';		 		$config['num_tag_open'] = '<li class="page">';		$config['num_tag_close'] = '</li>';				$config['next_link'] = 'Next';		$config['prev_link'] = 'Prev';         $this->pagination->initialize($config);		$heId = $this->session->userdata('HE_id');		$data['comapny_data'] = $this->company_model->get_companies($heId,$config["per_page"], $page);        $data["links"] = $this->pagination->create_links();				$this->load->view('clubs/hi_companies',$data);	}		public function filtered_companies($page=0)	{		$data['active']='hi_companies';		$data['sub_active']='hi_companies';				if($this->input->post('', TRUE)) {			$filter = $this->input->post('', TRUE);			$this->session->set_userdata('', $filter);		}		else {			$filter = $this->session->userdata('');		}			$config = array();        $config["base_url"] = base_url() . "clubs/hi_companies/filtered_companies";        $config["total_rows"] = $this->company_model->companies_filtered_count($filter);        $config["per_page"] = 20;		$config['num_links'] = 3;				$config['full_tag_open'] = '<div class="pagination"><ul>';		$config['full_tag_close'] = '</ul></div>';				$config['first_tag_open'] = '<li class="prev page">';		$config['first_tag_close'] = '</li>';		 		$config['last_tag_open'] = '<li class="next page">';		$config['last_tag_close'] = '</li>';				$config['next_tag_open'] = '<li class="next page">';		$config['next_tag_close'] = '</li>';				$config['prev_tag_open'] = '<li class="prev page">';		$config['prev_tag_close'] = '</li>';		 		$config['cur_tag_open'] = '<li class="active"><a href="">';		$config['cur_tag_close'] = '</a></li>';		 		$config['num_tag_open'] = '<li class="page">';		$config['num_tag_close'] = '</li>';				$config['next_link'] = 'Next';		$config['prev_link'] = 'Prev';         $this->pagination->initialize($config);		$heId = $this->session->userdata('HE_id');		$data['comapny_data'] = $this->company_model->get_filtered_companies($heId,$config["per_page"], $page, $filter);        $data["links"] = $this->pagination->create_links();				$data['active']='hi_companies';		$this->load->view('clubs/hi_companies',$data);	}		public function change_active()	{		$id = $this->input->post('id', TRUE);		$userExist = $this->company_model->change_active($id);	}		public function edit_company_info()	{		$data['active']='hi_companies';		$data['sub_active']='hi_companies';				$id = $this->input->post('id', TRUE);		$data['comapny_data'] = $this->company_model->get_company_info($id);		$data['comapny_data']= array_merge($data['comapny_data'],$this->company_model->get_company_address($id));		//print_r($data['comapny_data']);		$this->load->view('edit_company',$data);	}		public function edit_info_submit()	{			$HICompanyId  = $this->input->post('HICompanyId', TRUE);			$HIGovNum  = $this->input->post('HIGovNum', TRUE);			$HINationalCompanyID   = $this->input->post('HINationalCompanyID', TRUE);			$HIOfficialName   = $this->input->post('HIOfficialName', TRUE);			$HIFantasyName  = $this->input->post('HIFantasyName', TRUE);			$HIMedSquareInternalObs   = $this->input->post('HIMedSquareInternalObs', TRUE);						$HIAddress  = $this->input->post('HIAddress', TRUE);			$HIAddressNum   = $this->input->post('HIAddressNum', TRUE);			$HIComplement   = $this->input->post('HIComplement', TRUE);			$HINeighborhood  = $this->input->post('HINeighborhood', TRUE);			$HICity   = $this->input->post('HICity', TRUE);			$HIState  = $this->input->post('HIState', TRUE);			$HIZipcode  = $this->input->post('HIZipcode', TRUE);			$HICountry   = $this->input->post('HICountry', TRUE);			$HIPhoneCode   = $this->input->post('HIPhoneCode', TRUE);			$HIPhoneNum  = $this->input->post('HIPhoneNum', TRUE);			$HIFaxNumber   = $this->input->post('HIFaxNumber', TRUE);			$HIEmail   = $this->input->post('HIEmail', TRUE);					$arr = array('HIGovNum'=>$HIGovNum,'HINationalCompanyID'=>$HINationalCompanyID,'HIOfficialName' =>$HIOfficialName,'HIFantasyName'=>$HIFantasyName,'HIMedSquareInternalObs'=>$HIMedSquareInternalObs);						$userReqResult = $this->company_model->edit_company_info($HICompanyId,$arr);						$arr2 = array('HIAddress'=>$HIAddress,'HIAddressNum'=>$HIAddressNum,'HIComplement' =>$HIComplement,'HINeighborhood'=>$HINeighborhood,'HICity'=>$HICity,'HIState'=>$HIState,'HIZipcode'=>$HIZipcode,'HICountry'=>$HICountry,'HIPhoneCode'=>$HIPhoneCode,'HIPhoneNum'=>$HIPhoneNum,'HIFaxNumber'=>$HIFaxNumber,'HIEmail'=>$HIEmail);						$userReqResult = $this->company_model->edit_company_address($HICompanyId,$arr2);						header('Location: '.base_url().'hi_companies');	}		public function add_company()	{		$data['active']='hi_companies';		$data['sub_active']='hi_companies';				$this->load->view('add_company',$data);	}		public function add_companies()	{			$filename = './files/companies/'.$_FILES['upload']['name'];						copy($_FILES['upload']['tmp_name'],$filename);						function readCSV($csvFile){			$file_handle = fopen($csvFile, 'r');			while (!feof($file_handle) ) {				$line_of_text[] = fgetcsv($file_handle, 1024);			}			fclose($file_handle);			return $line_of_text;		}		$csv = readCSV($filename);				$i=0;		foreach($csv as $row) {						if($row[0]==NULL)				continue;							$i++;			if($i==1) {				continue;			}						$row[2]=str_replace('?', '', $row[2]);						$time=strtotime($row[19]);			$convTime = date('Y-m-d H:i:s',$time);						$arr = array('HIGovNum'=>$row[1],'HINationalCompanyID' => $row[2],'HIOfficialName'=>utf8_encode($row[3]),'HIFantasyName'=>utf8_encode($row[4]),'HIActive'=>'1','HIMedSquareInternalObs' => utf8_encode($row[18]),'HIInsertionDate' => $convTime);			$userReqResult = $this->company_model->add_company($arr);						if($userReqResult) {				$arr = array('HICompanyId'=>$userReqResult,'HIAddress'=>utf8_encode($row[5]),'HIAddressNum' => $row[6],'HIComplement'=>utf8_encode($row[7]),'HINeighborhood'=>utf8_encode($row[8]),'HICity' => utf8_encode($row[9]),'HIState' => utf8_encode($row[10]),'HIZipcode' => $row[11],'HICountry' => $row[12],'HIPhoneCode' => $row[13],'HIPhoneNum' => $row[14],'HIFaxNumber' => $row[15],'HIEmail' => utf8_encode($row[16]));				$userReqResult1 = $this->company_model->add_company_address($arr);			}		}				$data['active']='hi_companies';		$data['sub_active']='hi_companies';		$data['company_added']='Added '.($i-1).' companies successfully.';				$this->load->view('add_company',$data);	}		public function delete_company()	{		$id = $this->input->post('id', TRUE);		$userExist = $this->company_model->delete_company($id);	}			//plans		public function show_plans($page=0)	{		$data['active']='hi_companies';		$data['sub_active']='hi_plans';				if($this->session->userdata(''))			$this->session->unset_userdata('');				$config = array();        $config["base_url"] = base_url() . "clubs/hi_companies/show_plans";        $config["total_rows"] = $this->company_model->plans_count();        $config["per_page"] = 20;		$config['num_links'] = 3;				$config['full_tag_open'] = '<div class="pagination"><ul>';		$config['full_tag_close'] = '</ul></div>';				$config['first_tag_open'] = '<li class="prev page">';		$config['first_tag_close'] = '</li>';		 		$config['last_tag_open'] = '<li class="next page">';		$config['last_tag_close'] = '</li>';				$config['next_tag_open'] = '<li class="next page">';		$config['next_tag_close'] = '</li>';				$config['prev_tag_open'] = '<li class="prev page">';		$config['prev_tag_close'] = '</li>';		 		$config['cur_tag_open'] = '<li class="active"><a href="">';		$config['cur_tag_close'] = '</a></li>';		 		$config['num_tag_open'] = '<li class="page">';		$config['num_tag_close'] = '</li>';				$config['next_link'] = 'Next';		$config['prev_link'] = 'Prev';         $this->pagination->initialize($config);		$heId = $this->session->userdata('HE_id');		$data['comapny_data'] = $this->company_model->get_plans($heId,$config["per_page"], $page);        $data["links"] = $this->pagination->create_links();				$this->load->view('clubs/hi_plans',$data);	}		public function filtered_plans($page=0)	{		$data['active']='hi_companies';		$data['sub_active']='hi_plans';				if($this->input->post('', TRUE)) {			$filter = $this->input->post('', TRUE);			$this->session->set_userdata('', $filter);		}		else {			$filter = $this->session->userdata('');		}			$config = array();        $config["base_url"] = base_url() . "clubs/hi_companies/filtered_plans";        $config["total_rows"] = $this->company_model->plans_filtered_count($filter);        $config["per_page"] = 20;		$config['num_links'] = 3;				$config['full_tag_open'] = '<div class="pagination"><ul>';		$config['full_tag_close'] = '</ul></div>';				$config['first_tag_open'] = '<li class="prev page">';		$config['first_tag_close'] = '</li>';		 		$config['last_tag_open'] = '<li class="next page">';		$config['last_tag_close'] = '</li>';				$config['next_tag_open'] = '<li class="next page">';		$config['next_tag_close'] = '</li>';				$config['prev_tag_open'] = '<li class="prev page">';		$config['prev_tag_close'] = '</li>';		 		$config['cur_tag_open'] = '<li class="active"><a href="">';		$config['cur_tag_close'] = '</a></li>';		 		$config['num_tag_open'] = '<li class="page">';		$config['num_tag_close'] = '</li>';				$config['next_link'] = 'Next';		$config['prev_link'] = 'Prev';         $this->pagination->initialize($config);		$heId = $this->session->userdata('HE_id');		$data['comapny_data'] = $this->company_model->get_filtered_plans($heId,$config["per_page"], $page, $filter);        $data["links"] = $this->pagination->create_links();				$this->load->view('clubs/hi_plans',$data);	}		public function change_active_plan()	{		$id = $this->input->post('id', TRUE);		$userExist = $this->company_model->change_active_plan($id);	}		public function edit_plan_info()	{		$data['active']='hi_companies';		$data['sub_active']='hi_plans';				$id = $this->input->post('id', TRUE);		$data['comapny_data'] = $this->company_model->get_plan_info($id);				$this->load->view('edit_plan',$data);	}		public function edit_plan_submit()	{			$HIPlanId  = $this->input->post('HIPlanId', TRUE);			$HIFantasyName  = $this->input->post('HIFantasyName', TRUE);			$HIPlanName   = $this->input->post('HIPlanName', TRUE);			$HIPlanCode   = $this->input->post('HIPlanCode', TRUE);			$HIPlanDesc  = $this->input->post('HIPlanDesc', TRUE);			$HIMedSquareInternalObs   = $this->input->post('HIMedSquareInternalObs', TRUE);					$arr = array('HIFantasyName'=>$HIFantasyName,'HIPlanName'=>$HIPlanName,'HIPlanCode' =>$HIPlanCode,'HIPlanDesc'=>$HIPlanDesc,'HIMedSquareInternalObs'=>$HIMedSquareInternalObs);						$userReqResult = $this->company_model->edit_plan_info($HIPlanId,$arr);						header('Location: '.base_url().'hi_companies/show_plans');	}		public function add_plans()	{		$data['active']='hi_companies';		$data['sub_active']='hi_plans';				$this->load->view('add_plans',$data);	}		public function add_plans_submit()	{		$filename = './files/companies/'.$_FILES['upload']['name'];						copy($_FILES['upload']['tmp_name'],$filename);				function readCSV($csvFile){			$file_handle = fopen($csvFile, 'r');			while (!feof($file_handle) ) {				$line_of_text[] = fgetcsv($file_handle, 1024);			}			fclose($file_handle);			return $line_of_text;		}		$csv = readCSV($filename);				$i=0;		foreach($csv as $row) {						if($row[0]==NULL)				continue;						$i++;			if($i==1) {				continue;			}									$time=strtotime($row[7]);			$convTime = date('Y-m-d H:i:s',$time);						$arr = array('HIFantasyName'=>$row[1],'HIPlanName' => $row[2],'HIPlanCode'=>$row[3],'HIPlanDesc'=>utf8_encode($row[4]),'HIActive'=>'1','HIMedSquareInternalObs' =>utf8_encode( $row[6]),'HIInsertionDate' => $convTime);			$userReqResult = $this->company_model->add_plan($arr);		}				$data['active']='hi_companies';		$data['sub_active']='hi_plans';		$data['company_added']='Added '.($i-1).' companies successfully.';				$this->load->view('add_plans',$data);			}		public function delete_plan()	{		$id = $this->input->post('id', TRUE);		$userExist = $this->company_model->delete_plan($id);	}	public function getInnerHIPlan($page=0)	{		$data['active']='hi_companies';		$data['sub_active']='hi_plans';				$heId = $this->session->userdata('HE_id');		if($this->session->userdata(''))			$this->session->unset_userdata('');				$config = array();        $config["base_url"] = base_url() . "clubs/hi_companies/getInnerHIPlan";        $config["total_rows"] = $this->company_model->heplans_count($heId);		        $config["per_page"] = 20;		$config['num_links'] = 3;				$config['full_tag_open'] = '<div class="pagination"><ul>';		$config['full_tag_close'] = '</ul></div>';				$config['first_tag_open'] = '<li class="prev page">';		$config['first_tag_close'] = '</li>';		 		$config['last_tag_open'] = '<li class="next page">';		$config['last_tag_close'] = '</li>';				$config['next_tag_open'] = '<li class="next page">';		$config['next_tag_close'] = '</li>';				$config['prev_tag_open'] = '<li class="prev page">';		$config['prev_tag_close'] = '</li>';		 		$config['cur_tag_open'] = '<li class="active"><a href="">';		$config['cur_tag_close'] = '</a></li>';		 		$config['num_tag_open'] = '<li class="page">';		$config['num_tag_close'] = '</li>';				$config['next_link'] = 'Next';		$config['prev_link'] = 'Prev';         $this->pagination->initialize($config);		$data['comapny_data'] = $this->company_model->get_heplans($heId,$config["per_page"], $page);		        $data["links"] = $this->pagination->create_links();				$this->load->view('heInner/hi_plans',$data);	}	public function getInnerHICompany($page=0)	{				$data['active']='hi_companies';		$data['sub_active']='hi_companies';				$heId = $this->session->userdata('HE_id');		if($this->session->userdata(''))			$this->session->unset_userdata('');				$config = array();        $config["base_url"] = base_url() . "clubs/hi_companies/getInnerHICompany";        $config["total_rows"] = $this->company_model->hecompanies_count($heId);        $config["per_page"] = 20;		$config['num_links'] = 3;				$config['full_tag_open'] = '<div class="pagination"><ul>';		$config['full_tag_close'] = '</ul></div>';				$config['first_tag_open'] = '<li class="prev page">';		$config['first_tag_close'] = '</li>';		 		$config['last_tag_open'] = '<li class="next page">';		$config['last_tag_close'] = '</li>';				$config['next_tag_open'] = '<li class="next page">';		$config['next_tag_close'] = '</li>';				$config['prev_tag_open'] = '<li class="prev page">';		$config['prev_tag_close'] = '</li>';		 		$config['cur_tag_open'] = '<li class="active"><a href="">';		$config['cur_tag_close'] = '</a></li>';		 		$config['num_tag_open'] = '<li class="page">';		$config['num_tag_close'] = '</li>';				$config['next_link'] = 'Next';		$config['prev_link'] = 'Prev';         $this->pagination->initialize($config);		$data['comapny_data'] = $this->company_model->get_hecompanies($heId,$config["per_page"], $page);        $data["links"] = $this->pagination->create_links();				$this->load->view('heInner/hi_companies',$data);	}	}/* End of file welcome.php *//* Location: ./application/controllers/welcome.php */